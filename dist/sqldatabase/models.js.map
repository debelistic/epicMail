{"version":3,"sources":["../../server/sqldatabase/models.js"],"names":["require","dbURI","process","env","NODE_ENV","trim","TEST_DATABASE_URL","DATABASE_URL","pool","Pool","connectionString","on","console","log","createUsersTable","usersTableQuery","query","dropUsersTable","dropUsersQuery","messageStatustype","messageStatustypeQuery","dropmessageStatustype","dropmessageStatustypeQuery","createMessagesTable","messageQuery","dropMessagesTable","dropMessagesQuery","groupsTable","groupQuery","dropGroupsTable","dropGroupsQuery","groupMembersTable","groupMembersQuery","dropGroupMembersTable","dropGroupMembersQuery","groupMessagesTable","groupMessagesQuery","dropGroupMessage","dropgroupMessageQuery","createAllTables","connect","end","dropAllTables","exit","module","exports"],"mappings":"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","sourcesContent":["/* eslint-disable no-console */\nimport { Pool } from 'pg';\nimport { config } from 'dotenv';\n\nrequire('@babel/polyfill');\n\n\nconfig();\n\nlet dbURI;\n\nif (process.env.NODE_ENV.trim() === 'test') {\n  dbURI = process.env.TEST_DATABASE_URL;\n} else {\n  dbURI = process.env.DATABASE_URL;\n}\n\nconst pool = new Pool({\n  connectionString: dbURI,\n});\n\npool.on('connect', () => {\n  console.log('connected to db');\n});\n\n\n/**\n * create users table\n */\n\nconst createUsersTable = async () => {\n  const usersTableQuery = `CREATE TABLE IF NOT EXISTS\n      users(\n        id SERIAL PRIMARY KEY,\n        email VARCHAR(500) UNIQUE NOT NULL,\n        firstName VARCHAR(500) NOT NULL,\n        lastName VARCHAR(500) NOT NULL,\n        userImage TEXT,\n        password VARCHAR(500) NOT NULL,\n        recoveryEmail VARCHAR(500) UNIQUE NOT NULL,\n        createdOn TIMESTAMP,\n        modifiedOn TIMESTAMP\n      )`;\n  await pool.query(usersTableQuery);\n};\n\n/**\n * drop users table\n */\n\nconst dropUsersTable = async () => {\n  const dropUsersQuery = 'DROP TABLE IF EXISTS users';\n  await pool.query(dropUsersQuery);\n};\n\n/**\n * create messages status type\n */\nconst messageStatustype = async () => {\n  const messageStatustypeQuery = `CREATE TYPE message_status AS ENUM\n  (\n    'read',\n    'unread',\n    'draft'\n  )`;\n  await pool.query(messageStatustypeQuery);\n};\n\nconst dropmessageStatustype = async () => {\n  const dropmessageStatustypeQuery = 'DROP TYPE IF EXISTS message_status';\n  await pool.query(dropmessageStatustypeQuery);\n};\n\n/**\n * create messages table\n */\nconst createMessagesTable = async () => {\n  const messageQuery = `CREATE TABLE IF NOT EXISTS\n  messages(\n    id SERIAL PRIMARY KEY,\n    createdOn TIMESTAMP,\n    receiverEmail VARCHAR(500),\n    senderEmail VARCHAR(500) REFERENCES users (email),\n    subject TEXT NOT NULL DEFAULT 'No Subject',\n    message TEXT NOT NULL DEFAULT 'No Message',\n    parentMessageId UUID,\n    status message_status NOT NULL DEFAULT 'unread'\n  )`;\n  await pool.query(messageQuery);\n};\n\n/**\n * drop messages table\n */\nconst dropMessagesTable = async () => {\n  const dropMessagesQuery = 'DROP TABLE IF EXISTS messages';\n  await pool.query(dropMessagesQuery);\n};\n\n/**\n * create groups table\n */\nconst groupsTable = async () => {\n  const groupQuery = `CREATE TABLE IF NOT EXISTS \n      groups(\n        id UUID PRIMARY KEY,\n        name VARCHAR(128) UNIQUE NOT NULL,\n        description VARCHAR(500) NOT NULL,\n        ownerId VARCHAR(128) NOT NULL\n      )`;\n  await pool.query(groupQuery);\n};\n\n/**\n * drop groups table\n */\nconst dropGroupsTable = async () => {\n  const dropGroupsQuery = 'DROP TABLE IF EXISTS groups';\n  await pool.query(dropGroupsQuery);\n};\n\n/**\n * create group members table\n */\nconst groupMembersTable = async () => {\n  const groupMembersQuery = `CREATE TABLE IF NOT EXISTS \n      groupmembers(\n        id SERIAL PRIMARY KEY,\n        groupId UUID NOT NULL,\n        role TEXT NOT NULL DEFAULT 'member',\n        groupName VARCHAR(128) NOT NULL,\n        memberId VARCHAR(128) NOT NULL\n      )`;\n  await pool.query(groupMembersQuery);\n};\n\n/**\n * drop group members\n */\nconst dropGroupMembersTable = async () => {\n  const dropGroupMembersQuery = 'DROP TABLE IF EXISTS groupmembers';\n  await pool.query(dropGroupMembersQuery);\n};\n\n/**\n * create group messages tables\n */\nconst groupMessagesTable = async () => {\n  const groupMessagesQuery = `CREATE TABLE IF NOT EXISTS\n      groupmessages(\n        id UUID PRIMARY KEY,\n        senderEmail VARCHAR(128) NOT NULL,\n        groupId UUID NOT NULL,\n        subject TEXT NOT NULL,\n        message TEXT NOT NULL,\n        status message_status NOT NULL DEFAULT 'unread',\n        parrentMessageId UUID\n      )`;\n  await pool.query(groupMessagesQuery);\n};\n\n\n/**\n * drop group messages tables\n */\nconst dropGroupMessage = async () => {\n  const dropgroupMessageQuery = 'DROP TABLE IF EXISTS groupmessages';\n  await pool.query(dropgroupMessageQuery);\n};\n\n\nconst createAllTables = async () => {\n  pool.connect();\n  await createUsersTable();\n  await messageStatustype();\n  await createMessagesTable();\n  await groupsTable();\n  await groupMembersTable();\n  await groupMessagesTable();\n  pool.end();\n};\n\nconst dropAllTables = async () => {\n  pool.connect();\n  await dropGroupMembersTable();\n  await dropGroupMessage();\n  await dropGroupsTable();\n  await dropMessagesTable();\n  await dropUsersTable();\n  await dropmessageStatustype();\n  pool.end();\n};\n\npool.on('remove', () => {\n  pool.end();\n  console.log('client removed');\n  process.exit(0);\n});\n\nmodule.exports = {\n  createAllTables,\n  createUsersTable,\n  messageStatustype,\n  createMessagesTable,\n  groupsTable,\n  groupMembersTable,\n  groupMessagesTable,\n  dropUsersTable,\n  dropMessagesTable,\n  dropGroupsTable,\n  dropGroupMembersTable,\n  dropGroupMessage,\n  dropmessageStatustype,\n  dropAllTables,\n};\n\nrequire('make-runnable');\n"],"file":"models.js"}